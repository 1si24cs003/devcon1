<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIT Connect - Hack Your Campus</title>
    <!-- Tailwind & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        brand: { 50: '#eef2ff', 100: '#e0e7ff', 500: '#4f46e5', 600: '#4338ca', 900: '#312e81' },
                        accent: { 500: '#f59e0b' }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-100 text-slate-800 h-screen overflow-hidden font-sans">

    <!-- Login/Register Modal -->
    <div id="loginModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden">
            <div class="flex">
                <button id="loginTabBtn" class="w-1/2 p-4 font-medium text-center border-b-4 border-brand-600 text-brand-600">Login</button>
                <button id="regTabBtn" class="w-1/2 p-4 font-medium text-center border-b-4 border-transparent text-slate-500">Register</button>
            </div>
            
            <!-- Login Form -->
            <div id="loginTab" class="p-8 space-y-4">
                <h2 class="text-2xl font-bold text-center">Welcome Back to SIT Connect</h2>
                <div>
                    <label class="text-sm font-medium">Email</label>
                    <input type="email" id="loginEmail" class="w-full border border-slate-300 rounded-lg px-3 py-2 mt-1" placeholder="student@sit.ac.in">
                </div>
                <div>
                    <label class="text-sm font-medium">Password</label>
                    <input type="password" id="loginPass" class="w-full border border-slate-300 rounded-lg px-3 py-2 mt-1" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <p id="loginError" class="text-xs text-red-600"></p>
                <button id="loginBtn" class="w-full bg-brand-600 text-white rounded-lg py-3 font-medium hover:bg-brand-700">Login</button>
            </div>
            
            <!-- Register Form -->
            <div id="regTab" class="p-8 space-y-4" style="display: none;">
                <h2 class="text-2xl font-bold text-center">Create your SIT Connect Account</h2>
                <div>
                    <label class="text-sm font-medium">Email</label>
                    <input type="email" id="regEmail" class="w-full border border-slate-300 rounded-lg px-3 py-2 mt-1" placeholder="student@sit.ac.in">
                </div>
                <div>
                    <label class="text-sm font-medium">USN</label>
                    <input type="text" id="regUSN" class="w-full border border-slate-300 rounded-lg px-3 py-2 mt-1" placeholder="1SI21CS001">
                </div>
                <div>
                    <label class="text-sm font-medium">Program (e.g. B.E-CS)</label>
                    <input type="text" id="regProgram" class="w-full border border-slate-300 rounded-lg px-3 py-2 mt-1" placeholder="B.E-CS">
                </div>
                <div>
                    <label class="text-sm font-medium">Semester (e.g. 3)</label>
                    <input type="number" id="regSemester" class="w-full border border-slate-300 rounded-lg px-3 py-2 mt-1" placeholder="3">
                </div>
                <div>
                    <label class="text-sm font-medium">Date of Birth</label>
                    <input type="date" id="regDOB" class="w-full border border-slate-300 rounded-lg px-3 py-2 mt-1">
                </div>
                <div>
                    <label class="text-sm font-medium">Password</label>
                    <input type="password" id="regPass" class="w-full border border-slate-300 rounded-lg px-3 py-2 mt-1" placeholder="Min. 6 characters">
                </div>
                <p id="regError" class="text-xs text-red-600"></p>
                <button id="registerBtn" class="w-full bg-brand-600 text-white rounded-lg py-3 font-medium hover:bg-brand-700">Register</button>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-6">
            <h2 class="text-2xl font-bold text-slate-900">Are you sure?</h2>
            <p class="text-sm text-slate-600 mt-2">
                You are about to permanently delete all data for <strong id="deleteUserName"></strong>. This will remove their profile and all their tasks. This action cannot be undone.
            </p>
            <div class="flex gap-4 mt-6">
                <button id="cancelDeleteBtn" class="flex-1 bg-slate-200 text-slate-800 rounded-lg py-3 font-medium hover:bg-slate-300">
                    Cancel
                </button>
                <button id="confirmDeleteBtn" class="flex-1 bg-red-600 text-white rounded-lg py-3 font-medium hover:bg-red-700">
                    Yes, Delete User
                </button>
            </div>
        </div>
    </div>


    <!-- Main App (Hidden by default) -->
    <div id="mainApp" class="hidden h-screen w-full">

        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-white border-r border-slate-200 hidden md:flex flex-col z-20">
            <div class="p-6 flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl bg-brand-900 flex items-center justify-center text-white font-bold text-xl shadow-lg">SIT</div>
                <div>
                    <h1 class="text-lg font-bold text-slate-900">SIT Connect</h1>
                    <p class="text-xs text-slate-500">Tumakuru Campus</p>
                </div>
            </div>

            <nav class="flex-1 px-4 space-y-1 mt-4">
                <button data-section="dashboard" class="nav-btn w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg">
                    <i class="fa-solid fa-chart-pie w-5"></i> Dashboard
                </button>
                <button data-section="planner" class="nav-btn w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg">
                    <i class="fa-solid fa-wand-magic-sparkles w-5"></i> SIT Study AI
                </button>
                <button data-section="cafeteria" class="nav-btn w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg">
                    <i class="fa-solid fa-utensils w-5"></i> Food Courts
                </button>
                <button data-section="map" class="nav-btn w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg">
                    <i class="fa-solid fa-map-location-dot w-5"></i> Campus Map
                </button>
                <button data-section="campusbot" class="nav-btn w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg">
                    <i class="fa-solid fa-robot w-5"></i> Siddaganga Bot
                </button>
                <button id="adminNavButton" data-section="admin" class="nav-btn w-full flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg text-red-600" style="display: none;">
                    <i class="fa-solid fa-shield-halved w-5"></i> Admin
                </button>
            </nav>

            <div class="p-4 border-t border-slate-200">
                <p class="text-xs text-slate-500 mb-1">Logged in as:</p>
                <p id="userEmailDisplay" class="text-sm font-semibold text-slate-900 truncate">student@sit.ac.in</p>
                <button id="logoutBtn" class="text-xs text-brand-600 hover:underline mt-1">Logout</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col relative overflow-hidden">
            
            <!-- Mobile Header -->
            <header class="md:hidden bg-white border-b border-slate-200 p-4 flex justify-between items-center z-30">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-lg bg-brand-900 flex items-center justify-center text-white font-bold shadow-md text-xs">SIT</div>
                    <span class="font-bold text-lg">SIT Connect</span>
                </div>
                <button id="mobileMenuBtn" class="text-slate-600"><i class="fa-solid fa-bars text-xl"></i></button>
            </header>

            <!-- Mobile Menu Overlay -->
            <div id="mobileMenuClose" class="fixed inset-0 bg-black/50 z-40 hidden"></div>
            <div id="mobileSidebar" class="fixed inset-y-0 left-0 w-64 bg-white transform -translate-x-full transition-transform duration-300 z-50 md:hidden flex flex-col">
                <nav class="p-4 space-y-2 mt-6">
                    <button data-section="dashboard" class="mobile-nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-slate-100">Dashboard</button>
                    <button data-section="planner" class="mobile-nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-slate-100">Study AI</button>
                    <button data-section="cafeteria" class="mobile-nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-slate-100">Food Courts</button>
                    <button data-section="map" class="mobile-nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-slate-100">Campus Map</button>
                    <button data-section="campusbot" class="mobile-nav-btn w-full text-left px-4 py-3 rounded-lg hover:bg-slate-100">Siddaganga Bot</button>
                    <hr class="my-4">
                    <button id="mobileLogoutBtn" class="w-full text-left px-4 py-3 rounded-lg text-red-600 hover:bg-red-50">Logout</button>
                </nav>
            </div>

            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto p-4 md:p-8 relative bg-slate-50">
                
                <div id="toast" class="fixed top-4 right-4 bg-brand-900 text-white px-6 py-3 rounded-lg shadow-xl transform translate-y-[-150%] transition-transform duration-300 z-50">
                    <i class="fa-solid fa-circle-check text-green-400 mr-2"></i><span id="toastMessage"></span>
                </div>

                <!-- SECTION: DASHBOARD -->
                <section id="dashboard" class="section-content animate-fade-in space-y-6">
                    <h2 id="welcomeGreeting" class="text-3xl font-bold text-slate-900">Welcome, Student!</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                            <p class="text-slate-500 text-sm font-medium">USN</p>
                            <h3 id="profileUSN" class="text-3xl font-bold text-slate-900 mt-1 truncate">Loading...</h3>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                            <p class="text-slate-500 text-sm font-medium">Current CGPA</p>
                            <h3 id="profileCGPA" class="text-3xl font-bold text-slate-900 mt-1">0.0</h3>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                            <p class="text-slate-500 text-sm font-medium">Date of Birth</p>
                            <h3 id="profileDOB" class="text-xl font-bold text-slate-900 mt-1">Loading...</h3>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                            <p class="text-slate-500 text-sm font-medium">My Info</p>
                            <h3 id="profileProgram" class="text-xl font-bold text-slate-900 mt-1">Loading...</h3>
                            <p id="profileSemester" class="text-sm text-slate-600">Semester Loading...</p>
                            <p class="text-xs text-slate-500 mt-3 font-medium">Proctor: <span id="profileProctor" class="font-bold text-slate-700">DR. N.R. SUNITHA</span></p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm lg:col-span-2">
                            <h3 class="font-bold text-lg mb-4">Academic Performance (CGPA Trend)</h3>
                            <canvas id="studyChart" height="150"></canvas>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                            <h3 class="font-bold text-lg mb-4">SIT Events</h3>
                            <div class="space-y-4">
                                <div class="flex gap-3">
                                    <div class="w-12 h-12 rounded-lg bg-orange-100 text-orange-600 flex flex-col items-center justify-center flex-shrink-0">
                                        <span class="text-xs font-bold">OCT</span><span class="font-bold leading-none">13</span>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-sm">I Test (III, V, VII Sem)</h4>
                                        <p class="text-xs text-slate-500">Starts Oct 13th, Ends Oct 15th</p>
                                    </div>
                                </div>
                                <div class="flex gap-3">
                                    <div class="w-12 h-12 rounded-lg bg-indigo-100 text-indigo-600 flex flex-col items-center justify-center flex-shrink-0">
                                        <span class="text-xs font-bold">OCT</span><span class="font-bold leading-none">31</span>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-sm">Parents Meeting</h4>
                                        <p class="text-xs text-slate-500">Check Dept. for schedule</p>
                                    </div>
                                </div>
                                <div class="flex gap-3">
                                    <div class="w-12 h-12 rounded-lg bg-teal-100 text-teal-600 flex flex-col items-center justify-center flex-shrink-0">
                                        <span class="text-xs font-bold">NOV</span><span class="font-bold leading-none">21</span>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-sm">SPANDANA</h4>
                                        <p class="text-xs text-slate-500">Kannada Cultural Programme</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECTION: AI PLANNER -->
                <section id="planner" class="section-content hidden animate-fade-in max-w-4xl mx-auto">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-slate-900">CIE Preparation AI</h2>
                        <p class="text-slate-500 mt-2">Add a study goal. It will appear here and on your dashboard.</p>
                    </div>
                    <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
                        <div class="p-6 bg-slate-50 border-b border-slate-200">
                            <label class="block text-sm font-medium text-slate-700 mb-2">New Study Goal</label>
                            <div class="flex gap-2">
                                <input type="text" id="taskInput" placeholder="e.g. Prepare for Data Structures CIE" class="flex-1 rounded-lg border-slate-300 border px-4 py-3">
                                <button id="generatePlanBtn" class="bg-brand-600 hover:bg-brand-700 text-white px-6 py-3 rounded-lg font-medium">Add Task</button>
                            </div>
                        </div>
                        <div id="planResult" class="hidden"></div>
                        <div id="planEmpty" class="p-12 text-center text-slate-400">
                            <i class="fa-solid fa-brain text-6xl mb-4 opacity-20"></i>
                            <p>Your saved study tasks will appear here.</p>
                        </div>
                    </div>
                </section>

                <!-- SECTION: SMART CAFETERIA -->
                <section id="cafeteria" class="section-content hidden animate-fade-in space-y-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-3xl font-bold text-slate-900">SIT Food Courts (Live)</h2>
                            <p class="text-slate-500">Real-time crowd data simulated from class timetable.</p>
                        </div>
                    </div>
                    <div id="cafeteriaGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <p class="text-slate-500">Loading live data...</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                        <h3 class="font-bold text-lg mb-4">Peak Hour Prediction (Main Canteen)</h3>
                        <canvas id="trafficChart" height="100"></canvas>
                    </div>
                </section>

                <!-- NEW SECTION: MAP -->
                <section id="map" class="section-content hidden animate-fade-in space-y-6">
                    <h2 class="text-3xl font-bold text-slate-900">Interactive Campus Map</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-200 p-4">
                            <h3 class="font-bold text-lg mb-4">S.I.T. Campus Index Map</h3>
                            <!-- EMBEDDED Base64 IMAGE -->
                            <img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAcEBAcQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCAsUCwwDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAr/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAr/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD/AD/gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADBCBA" alt="SIT Campus Map" class="rounded-lg w-full object-contain" onerror="this.onerror=null;this.src='https.placehold.co/800x600/e2e8f0/94a3b8?text=Map+Image+Not+Found';">
                        </div>
                        <div class="lg:col-span-1 bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                            <h3 class="font-bold text-lg mb-4">Key Locations</h3>
                            <div class="space-y-3 max-h-[450px] overflow-y-auto pr-2">
                                <a href="https://maps.google.com/maps?cid=16683031220794618752" target="_blank" class="flex items-center gap-3 p-3 bg-slate-50 hover:bg-slate-100 rounded-lg">
                                    <i class="fa-solid fa-map-pin text-brand-600 w-5 text-center"></i>
                                    <span class="text-sm font-medium text-slate-700">Main Campus (SIT)</span>
                                </a>
                                <a href="https://goo.gl/maps/k1KJFbsqnpaFdua48" target="_blank" class="flex items-center gap-3 p-3 bg-slate-50 hover:bg-slate-100 rounded-lg">
                                    <i class="fa-solid fa-building text-slate-500 w-5 text-center"></i>
                                    <span class="text-sm font-medium text-slate-700">AD Block (Admin)</span>
                                </a>
                                <a href="https://goo.gl/maps/44g1VpNtGCz9Qnfr5" target="_blank" class="flex items-center gap-3 p-3 bg-slate-50 hover:bg-slate-100 rounded-lg">
                                    <i class="fa-solid fa-person-chalkboard text-slate-500 w-5 text-center"></i>
                                    <span class="text-sm font-medium text-slate-700">Civil Engg. Seminar Hall</span>
                                </a>
                                <a href="https://goo.gl/maps/fcdWAUoYqNbVF6DJA" target="_blank" class="flex items-center gap-3 p-3 bg-slate-50 hover:bg-slate-100 rounded-lg">
                                    <i class="fa-solid fa-microchip text-slate-500 w-5 text-center"></i>
                                    <span class="text-sm font-medium text-slate-700">ECE Dept.</span>
                                </a>
                                <a href="https://www.sit.ac.in/department/library-information-center" target="_blank" class="flex items-center gap-3 p-3 bg-slate-50 hover:bg-slate-100 rounded-lg">
                                    <i class="fa-solid fa-book-bookmark text-slate-500 w-5 text-center"></i>
                                    <span class="text-sm font-medium text-slate-700">T.N Kempahonnaiah Library</span>
                                </a>
                                <a href="https://www.sit.ac.in/hostels" target="_blank" class="flex items-center gap-3 p-3 bg-slate-50 hover:bg-slate-100 rounded-lg">
                                    <i class="fa-solid fa-bed text-slate-500 w-5 text-center"></i>
                                    <span class="text-sm font-medium text-slate-700">Basaveshwara Hostel Block</span>
                                </a>
                                <a href="https://www.sit.ac.in/hostels" target="_blank" class="flex items-center gap-3 p-3 bg-slate-50 hover:bg-slate-100 rounded-lg">
                                    <i class="fa-solid fa-bed text-slate-500 w-5 text-center"></i>
                                    <span class="text-sm font-medium text-slate-700">Akkamahadevi Block (Girls)</span>
                                </a>
                                <a href="https://www.sit.ac.in/campus-life/sports" target="_blank" class="flex items-center gap-3 p-3 bg-slate-50 hover:bg-slate-100 rounded-lg">
                                    <i class="fa-solid fa-futbol text-slate-500 w-5 text-center"></i>
                                    <span class="text-sm font-medium text-slate-700">SIT Stadium</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECTION: CAMPUS BOT -->
                <section id="campusbot" class="section-content hidden animate-fade-in h-[calc(100vh-8rem)] flex flex-col">
                    <div class="flex-1 bg-white rounded-2xl shadow-sm border border-slate-200 flex flex-col overflow-hidden max-w-3xl mx-auto w-full">
                        <div class="p-4 border-b"><h2 class="text-xl font-bold text-center text-slate-900">Siddaganga Bot ü§ñ</h2></div>
                        <div id="chatContainer" class="flex-1 p-6 overflow-y-auto space-y-4 bg-slate-50">
                            <div class="flex items-start gap-3"><div class="w-8 h-8 rounded-full bg-brand-100 flex items-center justify-center text-brand-600"><i class="fa-solid fa-robot text-sm"></i></div><div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm border border-slate-100 text-sm text-slate-700 max-w-[80%]">Hi! Ask me about campus locations (like "Where is the library?") or questions about this app (like "How to change CGPA?").</div></div>
                        </div>
                        <div class="p-4 bg-white border-t border-slate-200">
                            <div class="flex gap-2">
                                <input type="text" id="chatInput" placeholder="Type your question..." class="flex-1 rounded-full border-slate-300 border px-4 py-2 text-sm">
                                <button id="sendChatBtn" class="bg-brand-600 text-white w-10 h-10 rounded-full flex items-center justify-center hover:bg-brand-700"><i class="fa-solid fa-paper-plane text-sm"></i></button>
                            </div>
                            <div class="flex gap-2 mt-2 overflow-x-auto pb-1">
                                <button data-text="Where is Birla Auditorium?" class="fill-chat-btn whitespace-nowrap text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-1 rounded-full">üìç Birla Auditorium</button>
                                <button data-text="Library Timings?" class="fill-chat-btn whitespace-nowrap text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-1 rounded-full">üìö Library Hours</button>
                                <button data-text="How do I change my CGPA?" class="fill-chat-btn whitespace-nowrap text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-1 rounded-full">üßë‚Äçüéì Change CGPA</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECTION: ADMIN -->
                <section id="admin" class="section-content hidden animate-fade-in max-w-4xl mx-auto space-y-8">
                    <div class="text-center">
                        <h2 class="text-3xl font-bold text-slate-900">Admin Controls</h2>
                        <p class="text-slate-500 mt-2">Manage live data and user profiles.</p>
                    </div>

                    <!-- Cafeteria Controls -->
                    <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
                        <div class="p-5 border-b bg-slate-50"><h3 class="font-bold text-lg text-slate-800"><i class="fa-solid fa-sliders mr-2"></i> Live Cafeteria Data</h3></div>
                        <div class="p-8 space-y-4">
                            <p class="text-sm text-slate-600">Cafeteria traffic is now fully automated based on the college timetable to provide a real-time simulation.</p>
                            <ul class="list-disc list-inside text-sm text-slate-500 space-y-1">
                                <li><span class="font-medium text-slate-700">Class Hours:</span> Traffic set to <span class="text-green-600 font-medium">LOW</span>.</li>
                                <li><span class="font-medium text-slate-700">10:00 AM - 10:45 AM:</span> Traffic set to <span class="text-yellow-600 font-medium">HIGH</span>.</li>
                                <li><span class="font-medium text-slate-700">12:30 PM - 2:00 PM:</span> Traffic set to <span class="text-red-600 font-medium">PEAK</span>.</li>
                            </ul>
                            <p class="text-xs text-slate-400">This simulation updates for all users every 60 seconds.</p>
                        </div>
                    </div>

                    <!-- User Management -->
                    <div class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
                        <div class="p-5 border-b bg-slate-50 flex justify-between items-center">
                            <h3 class="font-bold text-lg text-slate-800"><i class="fa-solid fa-users-cog mr-2"></i> User Management</h3>
                            <button id="loadAllUsersBtn" class="bg-brand-600 hover:bg-brand-700 text-white px-4 py-2 rounded-lg font-medium text-sm">
                                <i class="fa-solid fa-sync mr-1"></i> Load All Students
                            </button>
                        </div>
                        
                        <!-- Hidden Edit Area -->
                        <div id="adminEditUserArea" class="hidden p-8 space-y-4 bg-slate-100 border-b border-slate-200">
                            <p class="text-sm font-medium">Editing Profile for: <strong id="adminEditEmail" class="text-brand-600"></strong></p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="text-sm font-medium">USN</label>
                                    <input type="text" id="adminEditUSN" class="w-full border border-slate-300 rounded-lg px-3 py-2 mt-1">
                                </div>
                                <div>
                                    <label class="text-sm font-medium">Program (e.g. B.E-CS)</label>
                                    <input type="text" id="adminEditProgram" class="w-full border border-slate-300 rounded-lg px-3 py-2 mt-1">
                                </div>
                                <div>
                                    <label class="text-sm font-medium">Semester</label>
                                    <input type="number" id="adminEditSemester" class="w-full border border-slate-300 rounded-lg px-3 py-2 mt-1">
                                </div>
                                <div>
                                    <label class="text-sm font-medium">Date of Birth</label>
                                    <input type="date" id="adminEditDOB" class="w-full border border-slate-300 rounded-lg px-3 py-2 mt-1">
                                </div>
                                <div>
                                    <label class="text-sm font-medium">CGPA</label>
                                    <input type="number" id="adminEditCGPA" step="0.01" min="0" max="10" class="w-full border border-slate-300 rounded-lg px-3 py-2 mt-1">
                                </div>
                            </div>
                            <div class="flex gap-2 pt-2">
                                <button id="saveUserBtn" class="flex-1 bg-green-600 text-white rounded-lg py-3 font-medium hover:bg-green-700">
                                    <i class="fa-solid fa-save mr-2"></i> Save User Changes
                                </button>
                                <button id="cancelSaveUserBtn" class="bg-slate-500 text-white rounded-lg py-3 px-4 font-medium hover:bg-slate-600">
                                    Cancel
                                </button>
                            </div>
                        </div>

                        <!-- User List Table -->
                        <div id="adminUserListContainer" class="p-8">
                            <p id="adminUserListEmpty" class="text-sm text-slate-500 text-center">Click "Load All Students" to see user data.</p>
                            <div class="max-h-[400px] overflow-y-auto">
                                <table id="adminUserList" class="hidden w-full text-left text-sm">
                                    <thead class="border-b border-slate-300 text-slate-500 sticky top-0 bg-white">
                                        <tr>
                                            <th class="py-2 px-3">Email</th>
                                            <th class="py-2 px-3">USN</th>
                                            <th class="py-2 px-3">Program</th>
                                            <th class="py-2 px-3">CGPA</th>
                                            <th class="py-2 px-3"></th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-100" id="adminUserListBody">
                                        <!-- User rows will be injected here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            addDoc, 
            collection, 
            onSnapshot, 
            query, 
            deleteDoc,
            serverTimestamp,
            getDoc,
            getDocs,
            updateDoc,
            where,
            writeBatch
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- GLOBAL APP STATE ---
        let auth, db;
        let userId = null;
        let studyPlanUnsubscribe = null;
        let cafeteriaUnsubscribe = null;
        let profileUnsubscribe = null; // Listener for profile data
        let currentLiveData = {}; // Store current live data
        let adminEditingUserId = null; // Store which user is being edited
        let userToDelete = null; // Store user info for deletion
        let trafficSimulationTimer = null; // Timer for cafeteria simulation

        // --- FIREBASE CONFIG ---
        // User's actual Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBgLNarhtQ94FqMih4H3-qu0lE5jUu79QQ",
            authDomain: "sit-connect-hackathon.firebaseapp.com",
            projectId: "sit-connect-hackathon",
            storageBucket: "sit-connect-hackathon.firebasestorage.app",
            messagingSenderId: "600010413731",
            appId: "1:600010413731:web:62a6b47ccf280b05bcd116",
            measurementId: "G-HQ64BNDDZP"
        };
        // ‚¨ÜÔ∏è User's actual Firebase config ‚¨ÜÔ∏è

        // --- INITIALIZE FIREBASE ---
        try {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            console.log("Firebase Initialized Successfully!");
        } catch (e) {
            console.error("Error initializing Firebase:", e);
        }

        // --- This needs to be defined for the listeners ---
        const appId = firebaseConfig.projectId; // Use your project ID as the appId

        // --- AUTHENTICATION ---
        onAuthStateChanged(auth, async (user) => {
            const loginModal = document.getElementById('loginModal');
            const mainApp = document.getElementById('mainApp');

            if (user) {
                // User is signed in
                userId = user.uid;
                document.getElementById('userEmailDisplay').textContent = user.email || 'Student';
                
                // Hide modal, show app
                loginModal.classList.add('hidden');
                mainApp.classList.remove('hidden');
                mainApp.classList.add('flex');

                // *** ADMIN CHECK - NOW VISIBLE TO ALL ***
                document.getElementById('adminNavButton').style.display = 'flex';
                
                // Start listening to live data
                setWelcomeGreeting();
                showSection('dashboard');
                listenToStudyPlan();
                listenToCafeteriaData();
                listenToProfile();
                
                // Start the cafeteria simulation
                startTrafficSimulation();

            } else {
                // User is signed out
                userId = null;
                // Show modal, hide app
                loginModal.classList.remove('hidden');
                mainApp.classList.add('hidden');
                mainApp.classList.remove('flex');

                // Hide admin button on logout
                document.getElementById('adminNavButton').style.display = 'none';

                // Stop listening to data
                if (studyPlanUnsubscribe) studyPlanUnsubscribe();
                if (cafeteriaUnsubscribe) cafeteriaUnsubscribe();
                if (profileUnsubscribe) profileUnsubscribe();
                if (trafficSimulationTimer) clearInterval(trafficSimulationTimer);
            }
        });
        
        // --- FIRESTORE DATA LISTENERS ---

        // Listen to the user's personal study plan
        function listenToStudyPlan() {
            if (!userId) return;
            if (studyPlanUnsubscribe) studyPlanUnsubscribe(); // Detach old listener
            
            const tasksCollection = collection(db, `artifacts/${appId}/users/${userId}/tasks`);
            const q = query(tasksCollection);

            studyPlanUnsubscribe = onSnapshot(q, (snapshot) => {
                const tasks = [];
                snapshot.forEach((doc) => {
                    tasks.push({ id: doc.id, ...doc.data() });
                });
                renderTasks(tasks);
            }, (error) => {
                console.error("Error fetching tasks:", error);
            });
        }
        
        // Listen to public, real-time cafeteria data
        function listenToCafeteriaData() {
            if (cafeteriaUnsubscribe) cafeteriaUnsubscribe(); // Detach old listener
            
            const cafeteriaDoc = doc(db, `artifacts/${appId}/public/data/campus`, "liveData");

            cafeteriaUnsubscribe = onSnapshot(cafeteriaDoc, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    currentLiveData = data; // Save data
                    updateCafeteriaUI(data);
                } else {
                    console.log("No cafeteria data! Creating sample doc...");
                    setDoc(cafeteriaDoc, {
                        mainCanteen: 15,
                        nescafe: 10,
                        nandini: 5,
                        simulation: 'active'
                    });
                }
            }, (error) => {
                console.error("Error fetching cafeteria data:", error);
            });
        }
        
        // Listen to this user's profile
        function listenToProfile() {
            if (!userId) return;
            if (profileUnsubscribe) profileUnsubscribe();

            const profileDoc = doc(db, `artifacts/${appId}/users/${userId}/profile`, 'userData');
            profileUnsubscribe = onSnapshot(profileDoc, (doc) => {
                if(doc.exists()) {
                    const data = doc.data();
                    document.getElementById('profileUSN').textContent = data.usn || 'Not Set';
                    document.getElementById('profileCGPA').textContent = data.cgpa ? data.cgpa.toFixed(1) : '0.0';
                    document.getElementById('profileDOB').textContent = data.dob || 'Not Set';
                    document.getElementById('profileProgram').textContent = data.program || 'Not Set';
                    document.getElementById('profileSemester').textContent = data.semester ? `Semester ${data.semester}` : 'Not Set';
                } else {
                    console.log("No profile data for this user.");
                    document.getElementById('profileUSN').textContent = 'Please Set';
                    document.getElementById('profileCGPA').textContent = 'N/A';
                    document.getElementById('profileDOB').textContent = 'N/A';
                    document.getElementById('profileProgram').textContent = 'N/A';
                    document.getElementById('profileSemester').textContent = 'N/A';
                }
            }, (error) => {
                console.error("Error fetching profile:", error);
            });
        }
        
        // --- UI RENDERING ---

        // Set dynamic welcome greeting
        function setWelcomeGreeting() {
            const hour = new Date().getHours();
            const greetingEl = document.getElementById('welcomeGreeting');
            if (hour < 12) {
                greetingEl.textContent = 'Good Morning, Student!';
            } else if (hour < 18) {
                greetingEl.textContent = 'Good Afternoon, Student!';
            } else {
                greetingEl.textContent = 'Good Evening, Student!';
            }
        }

        // Render tasks on the dashboard and planner
        function renderTasks(tasks) {
            const plannerEmpty = document.getElementById('planEmpty');
            const plannerResult = document.getElementById('planResult');
            const planResultContainer = document.getElementById('planResult');

            if (tasks.length === 0) {
                plannerEmpty.classList.remove('hidden');
                plannerResult.classList.add('hidden');
                planResultContainer.innerHTML = '';
            } else {
                plannerEmpty.classList.add('hidden');
                plannerResult.classList.remove('hidden');
                
                let html = `<div class="bg-white">
                    <div class="p-4 bg-brand-50 border-b border-brand-100">
                        <h3 class="font-bold text-brand-800"><i class="fa-solid fa-check-double mr-2"></i>Your Study Plan</h3>
                    </div>
                    <div class="divide-y divide-slate-100">`;
                
                tasks.forEach((task, index) => {
                    html += `
                        <div class="p-4 flex gap-4 hover:bg-slate-50 transition-colors group">
                            <div class="flex flex-col items-center">
                                <div class="w-8 h-8 rounded-full border-2 border-brand-200 text-brand-600 font-bold flex items-center justify-center text-sm bg-white group-hover:bg-brand-500 group-hover:text-white transition-colors">${index + 1}</div>
                                ${index !== tasks.length -1 ? '<div class="w-0.5 h-full bg-slate-200 my-1"></div>' : ''}
                            </div>
                            <div class="flex-1 pb-2">
                                <div class="flex justify-between mb-1">
                                    <h4 class="font-bold text-slate-800">${task.title}</h4>
                                    <span class="text-xs font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded"><i class="fa-regular fa-clock mr-1"></i>${task.time}</span>
                                </div>
                                <p class="text-sm text-slate-600">${task.desc}</p>
                                <button data-task-id="${task.id}" class="delete-task-btn mt-2 text-xs text-red-500 font-medium hover:underline">Mark Done</button>
                            </div>
                        </div>
                    `;
                });
                html += `</div></div>`;
                planResultContainer.innerHTML = html;

                // Add event listeners to new delete buttons
                document.querySelectorAll('.delete-task-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        deleteTask(btn.dataset.taskId);
                    });
                });
            }
        }

        // Update cafeteria UI with live data
        function updateCafeteriaUI(data) {
            const venues = [
                { id: 'mainCanteen', name: 'SIT Main Canteen', value: data.mainCanteen || 0 },
                { id: 'nescafe', name: 'Nescafe Point', value: data.nescafe || 0 },
                { id: 'nandini', name: 'Nandini Parlour', value: data.nandini || 0 }
            ];

            const container = document.getElementById('cafeteriaGrid');
            container.innerHTML = ''; // Clear existing
            
            venues.forEach(venue => {
                let status, color, wait, icon;
                if (venue.value > 80) {
                    status = 'PEAK';
                    color = 'red';
                    wait = '~20 mins';
                } else if (venue.value > 40) {
                    status = 'HIGH';
                    color = 'yellow';
                    wait = '~10 mins';
                } else {
                    status = 'LOW';
                    color = 'green';
                    wait = '~2 mins';
                }
                
                if (venue.id === 'mainCanteen') icon = 'fa-utensils text-orange-400';
                else if (venue.id === 'nescafe') icon = 'fa-mug-hot text-stone-400';
                else icon = 'fa-ice-cream text-blue-400';

                const html = `
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                        <div class="h-32 bg-slate-200 relative flex items-center justify-center bg-gradient-to-r from-${color}-100 to-${color}-200">
                            <i class="fa-solid ${icon} text-4xl opacity-50"></i>
                            <div class="absolute top-3 right-3 bg-${color}-500 text-white text-xs font-bold px-2 py-1 rounded-full shadow-sm">${status}</div>
                        </div>
                        <div class="p-5">
                            <h3 class="font-bold text-lg">${venue.name}</h3>
                            <div class="space-y-3 mt-4">
                                <div>
                                    <div class="flex justify-between text-xs mb-1">
                                        <span class="font-medium text-slate-600">Current Crowd</span>
                                        <span class="text-${color}-600 font-bold">${venue.value}%</span>
                                    </div>
                                    <div class="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
                                        <div class="bg-${color}-500 h-full" style="width: ${venue.value}%"></div>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center pt-2 border-t border-slate-100">
                                    <span class="text-xs text-slate-500">Wait: <strong class="text-slate-800">${wait}</strong></span>
                                </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }
        
        // --- FIRESTORE WRITE ACTIONS ---

        // Add a new task to the study plan
        async function generatePlan() {
            if (!userId) return showToast("You must be logged in to create a plan.");
            
            const input = document.getElementById('taskInput');
            const task = input.value.trim();
            if (!task) return showToast('Please enter a topic!');

            const aiPlan = {
                title: task.length > 20 ? task.substring(0, 20) + '...' : task,
                desc: 'Review notes and solve previous year questions.',
                time: '2 Hours',
                createdAt: serverTimestamp()
            };
            
            try {
                const tasksCollection = collection(db, `artifacts/${appId}/users/${userId}/tasks`);
                await addDoc(tasksCollection, aiPlan);
                showToast('Plan added to your dashboard!');
                input.value = '';
            } catch (e) {
                console.error("Error adding document: ", e);
                showToast('Error saving plan.');
            }
        }
        
        // Delete a task
        async function deleteTask(taskId) {
            if (!userId || !taskId) return;
            try {
                const taskDoc = doc(db, `artifacts/${appId}/users/${userId}/tasks`, taskId);
                await deleteDoc(taskDoc);
                showToast('Task completed!');
            } catch (e) {
                console.error("Error deleting task: ", e);
                showToast('Error removing task.');
            }
        }

        // --- AUTH ACTIONS (Register, Login, Logout) ---
        async function handleRegister() {
            const email = document.getElementById('regEmail').value;
            const usn = document.getElementById('regUSN').value;
            const dob = document.getElementById('regDOB').value;
            const program = document.getElementById('regProgram').value;
            const semester = document.getElementById('regSemester').value;
            const pass = document.getElementById('regPass').value;
            const errorEl = document.getElementById('regError');

            if (!email || !usn || !dob || !pass || !program || !semester) {
                errorEl.textContent = "Please fill in all fields.";
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                const user = userCredential.user;
                
                // ** FIX: Create parent document for querying **
                const parentUserDocRef = doc(db, `artifacts/${appId}/users`, user.uid);
                await setDoc(parentUserDocRef, {
                    email: user.email,
                    usn: usn,
                    program: program
                });

                // Create profile subcollection document
                const profileData = {
                    email: user.email,
                    usn: usn,
                    dob: dob,
                    program: program,
                    semester: parseInt(semester),
                    cgpa: 8.0, // Default CGPA
                    createdAt: serverTimestamp()
                };
                
                const userDocRef = doc(db, `artifacts/${appId}/users/${user.uid}/profile`, 'userData');
                await setDoc(userDocRef, profileData);
                
            } catch (error) {
                errorEl.textContent = error.message;
            }
        }
        
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            const errorEl = document.getElementById('loginError');
            try {
                await signInWithEmailAndPassword(auth, email, pass);
            } catch (error) {
                errorEl.textContent = error.message;
            }
        }
        
        async function handleLogout() {
            await signOut(auth);
        }

        // --- ADMIN FUNCTIONS ---
        
        // Load all user profiles into the admin table
        async function loadAllUsers() {
            const tableBody = document.querySelector("#adminUserList tbody");
            const emptyMsg = document.getElementById('adminUserListEmpty');
            const table = document.getElementById('adminUserList');
            tableBody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-slate-500">Loading...</td></tr>';
            table.classList.remove('hidden');
            emptyMsg.classList.add('hidden');

            try {
                // ** FIX: Query the parent 'users' collection **
                const usersCollectionRef = collection(db, `artifacts/${appId}/users`);
                const userDocsSnapshot = await getDocs(usersCollectionRef);
                
                let allProfiles = [];
                // This loop will now correctly find all user documents
                for (const userDoc of userDocsSnapshot.docs) { 
                    const profileDocRef = doc(db, `artifacts/${appId}/users/${userDoc.id}/profile`, 'userData');
                    const profileDoc = await getDoc(profileDocRef);
                    
                    if (profileDoc.exists()) {
                        allProfiles.push({ id: userDoc.id, ...profileDoc.data() });
                    } else {
                        // This can happen if profile creation failed, but parent doc exists
                        console.warn("User doc found but no profile sub-doc:", userDoc.id);
                        // Still add them to the list, but with data from the parent doc
                        const parentData = userDoc.data();
                        allProfiles.push({ 
                            id: userDoc.id, 
                            email: parentData.email, 
                            usn: parentData.usn,
                            program: parentData.program,
                            cgpa: 'N/A',
                            dob: 'N/A',
                            semester: 'N/A'
                        });
                    }
                }
                
                if (allProfiles.length === 0) {
                    table.classList.add('hidden');
                    emptyMsg.classList.remove('hidden');
                    return;
                }

                tableBody.innerHTML = ''; // Clear loading
                allProfiles.forEach(user => {
                    const userJson = JSON.stringify({
                        id: user.id,
                        email: user.email,
                        usn: user.usn,
                        dob: user.dob,
                        cgpa: user.cgpa,
                        program: user.program,
                        semester: user.semester
                    }).replace(/'/g, "\\'"); // Escape single quotes

                    tableBody.innerHTML += `
                        <tr class="hover:bg-slate-50">
                            <td class="py-3 px-3 font-medium text-slate-800">${user.email}</td>
                            <td class="py-3 px-3">${user.usn || 'N/A'}</td>
                            <td class="py-3 px-3">${user.program || 'N/A'}</td>
                            <td class="py-3 px-3 font-medium">${(typeof user.cgpa === 'number') ? user.cgpa.toFixed(1) : 'N/A'}</td>
                            <td class="py-3 px-3 text-right">
                                <button data-user='${userJson}' class="edit-user-btn text-sm text-brand-600 font-medium hover:underline">Edit</button>
                                <button data-user-id="${user.id}" data-user-email="${user.email}" class="delete-user-btn text-sm text-red-600 font-medium hover:underline ml-2">Delete</button>
                            </td>
                        </tr>
                    `;
                });

                // Add listeners to new edit buttons
                document.querySelectorAll('.edit-user-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const userData = JSON.parse(btn.dataset.user);
                        editUser(userData);
                    });
                });
                
                // Add listeners to new delete buttons
                document.querySelectorAll('.delete-user-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        showDeleteModal(btn.dataset.userId, btn.dataset.userEmail);
                    });
                });

            } catch (e) {
                console.error("Error loading users: ", e);
                tableBody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-red-500">Error loading users.</td></tr>';
            }
        }
        
        // Show the edit form with the user's data
        function editUser(user) {
            adminEditingUserId = user.id;
            document.getElementById('adminEditUserArea').classList.remove('hidden');
            document.getElementById('adminEditEmail').textContent = user.email;
            document.getElementById('adminEditUSN').value = user.usn || '';
            document.getElementById('adminEditDOB').value = user.dob || '';
            document.getElementById('adminEditCGPA').value = (typeof user.cgpa === 'number') ? user.cgpa : 0;
            document.getElementById('adminEditProgram').value = user.program || '';
            document.getElementById('adminEditSemester').value = (typeof user.semester === 'number') ? user.semester : 0;
        }

        // Hide the edit form
        function cancelAdminUserSave() {
            adminEditingUserId = null;
            document.getElementById('adminEditUserArea').classList.add('hidden');
        }
        
        // Save the updated user data
        async function handleAdminUserSave() {
            if (!adminEditingUserId) return;

            const updatedData = {
                usn: document.getElementById('adminEditUSN').value,
                dob: document.getElementById('adminEditDOB').value,
                cgpa: parseFloat(document.getElementById('adminEditCGPA').value),
                program: document.getElementById('adminEditProgram').value,
                semester: parseInt(document.getElementById('adminEditSemester').value)
            };

            try {
                // ** FIX: Use setDoc with merge to CREATE or UPDATE **
                const userDocRef = doc(db, `artifacts/${appId}/users/${adminEditingUserId}/profile`, 'userData');
                await setDoc(userDocRef, updatedData, { merge: true });
                
                // ** FIX: Also update the parent doc for querying **
                const parentUserDocRef = doc(db, `artifacts/${appId}/users`, adminEditingUserId);
                await setDoc(parentUserDocRef, {
                    usn: updatedData.usn,
                    program: updatedData.program
                }, { merge: true }); // Use setDoc with merge here too

                showToast('User profile updated successfully!');
                cancelAdminUserSave(); // Hide form
                loadAllUsers(); // Refresh list
            } catch (e) {
                console.error("Error updating user: ", e);
                showToast('Error updating profile.');
            }
        }
        
        // --- DELETE USER FUNCTIONS ---
        function showDeleteModal(userId, userEmail) {
            userToDelete = { id: userId, email: userEmail };
            document.getElementById('deleteUserName').textContent = userEmail;
            document.getElementById('deleteModal').classList.remove('hidden');
        }
        
        function hideDeleteModal() {
            userToDelete = null;
            document.getElementById('deleteModal').classList.add('hidden');
        }
        
        async function handleAdminDeleteUser() {
            if (!userToDelete) return;
            
            const userId = userToDelete.id;
            showToast('Deleting user data...');
            
            try {
                // 1. Delete all tasks in the "tasks" subcollection
                const tasksCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/tasks`);
                const tasksSnapshot = await getDocs(tasksCollectionRef);
                const batch = writeBatch(db);
                tasksSnapshot.forEach((taskDoc) => {
                    batch.delete(taskDoc.ref);
                });
                await batch.commit();

                // 2. Delete the user's profile document
                const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/profile`, 'userData');
                await deleteDoc(userDocRef);
                
                // ** FIX: Delete the parent user document **
                const parentUserDocRef = doc(db, `artifacts/${appId}/users`, userId);
                await deleteDoc(parentUserDocRef);
                
                showToast('User data deleted successfully.');
                hideDeleteModal();
                loadAllUsers(); // Refresh the list
            } catch (e) {
                console.error("Error deleting user data: ", e);
                showToast('Error deleting user.');
                hideDeleteModal();
            }
        }


        // --- AUTOMATED TRAFFIC SIMULATION ---
        function startTrafficSimulation() {
            if (trafficSimulationTimer) clearInterval(trafficSimulationTimer); // Clear old timer
            
            const updateTraffic = async () => {
                const now = new Date();
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();
                const currentTime = currentHour + (currentMinute / 60); // e.g., 10:30 = 10.5
                
                let canteenLevel, nescafeLevel, nandiniLevel;

                if (currentTime >= 12.5 && currentTime < 14.0) { // 12:30 PM - 2:00 PM
                    canteenLevel = 95; nescafeLevel = 80; nandiniLevel = 75; // PEAK
                }
                else if (currentTime >= 10.0 && currentTime < 10.75) { // 10:00 AM - 10:45 AM
                    canteenLevel = 60; nescafeLevel = 70; nandiniLevel = 50; // HIGH
                }
                else { // All other times
                    canteenLevel = 15; nescafeLevel = 10; nandiniLevel = 5; // LOW
                }
                
                const cafeteriaDoc = doc(db, `artifacts/${appId}/public/data/campus`, "liveData");
                try {
                    await setDoc(cafeteriaDoc, {
                        mainCanteen: canteenLevel,
                        nescafe: nescafeLevel,
                        nandini: nandiniLevel,
                        simulation: 'active'
                    }, { merge: true });
                } catch (e) {
                    console.error("Error writing simulation data: ", e);
                }
            };

            updateTraffic();
            trafficSimulationTimer = setInterval(updateTraffic, 60000);
        }

        
        // --- Chatbot (UPGRADED) ---
        const mapLocations = {
            "admin": { name: "AD Block (Admin)", link: "https://goo.gl/maps/k1KJFbsqnpaFdua48", index: 1 },
            "library": { name: "T.N Kempahonnaiah Library", link: "https://www.sit.ac.in/department/library-information-center", index: 3 },
            "ece": { name: "ECE Dept.", link: "https://goo.gl/maps/fcdWAUoYqNbVF6DJA", index: 16 },
            "civil": { name: "Civil Engg. Seminar Hall", link: "https://goo.gl/maps/44g1VpNtGCz9Qnfr5", index: 17 },
            "stadium": { name: "SIT Stadium", link: "https://www.sit.ac.in/campus-life/sports", index: 33 },
            "hostel": { name: "Basaveshwara Hostel", link: "https://www.sit.ac.in/hostels", index: 21 },
            "canteen": { name: "Canteen", link: "#", index: 17 },
            "birla": { name: "Birla Auditorium", link: "#", index: 2 }
        };

        function getBotReply(text) {
            const lower = text.toLowerCase();
            
            // Location Questions
            if (lower.includes('library')) {
                return `The <strong>${mapLocations.library.name}</strong> is <strong>#${mapLocations.library.index}</strong> on the map. <a href="${mapLocations.library.link}" target="_blank" class="text-brand-600 underline">Get details here</a>.`;
            }
            if (lower.includes('admin') || lower.includes('ad block')) {
                return `The <strong>${mapLocations.admin.name}</strong> is <strong>#${mapLocations.admin.index}</strong> on the map. <a href="${mapLocations.admin.link}" target="_blank" class="text-brand-600 underline">Open in Google Maps</a>.`;
            }
            if (lower.includes('ece') || lower.includes('communication')) {
                return `The <strong>${mapLocations.ece.name}</strong> is <strong>#${mapLocations.ece.index}</strong> on the map. <a href="${mapLocations.ece.link}" target="_blank" class="text-brand-600 underline">Open in Google Maps</a>.`;
            }
            if (lower.includes('civil')) {
                return `The <strong>${mapLocations.civil.name}</strong> is <strong>#${mapLocations.civil.index}</strong> on the map. <a href="${mapLocations.civil.link}" target="_blank" class="text-brand-600 underline">Open in Google Maps</a>.`;
            }
            if (lower.includes('stadium') || lower.includes('ground')) {
                return `The <strong>${mapLocations.stadium.name}</strong> is <strong>#${mapLocations.stadium.index}</strong> on the map. <a href="${mapLocations.stadium.link}" target="_blank" class="text-brand-600 underline">Get details here</a>.`;
            }
            if (lower.includes('birla') || lower.includes('auditorium')) {
                return `The <strong>Birla Auditorium</strong> is <strong>#${mapLocations.birla.index}</strong> on the map, near the main entrance.`;
            }
            if (lower.includes('where is')) {
                return `I can give you links for the Library, ECE Dept, Admin Block, Civil Hall, and Stadium. Try one of those!`;
            }

            // App Questions
            if (lower.includes('cgpa') || lower.includes('change my data')) {
                return `Go to the <strong>Admin</strong> section (red button on the sidebar). Click "Load All Students," find your email, and click "Edit" to update your profile.`;
            }
            if (lower.includes('app') || lower.includes('what is this')) {
                return `I'm SIT Connect! A platform to help you manage your campus life, from live cafeteria traffic to your study plan and campus map.`;
            }
            if (lower.includes('cie') || lower.includes('exam')) {
                return `Check the <strong>SIT Events</strong> card on your Dashboard for the latest CIE and Test dates.`;
            }
            if (lower.includes('traffic') || lower.includes('food')) {
                return `Go to the <strong>Food Courts</strong> section to see a live simulation of how busy the canteens are, based on the class timetable.`;
            }

            // Default
            return "I'm still learning! Try asking about campus locations (like 'Where is the library?') or how to use the app (like 'How do I change my CGPA?').";
        }
        
        // --- UI Functions (now defined as named functions) ---
        function showSection(sectionId) {
            document.querySelectorAll('.section-content').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById(sectionId);
            if(target) target.classList.remove('hidden');

            document.querySelectorAll('.nav-btn').forEach(btn => {
                if(btn.dataset.section === sectionId) {
                    btn.classList.add('bg-brand-50', 'text-brand-600');
                    btn.classList.remove('text-slate-600');
                } else {
                    btn.classList.remove('bg-brand-50', 'text-brand-600');
                    btn.classList.add('text-slate-600');
                }
            });

            if(sectionId === 'dashboard') renderStudyChart();
            if(sectionId === 'cafeteria') renderTrafficChart();
        }
        
        function toggleMobileMenu() {
            document.getElementById('mobileMenuClose').classList.toggle('hidden');
            document.getElementById('mobileSidebar').classList.toggle('-translate-x-full');
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.remove('translate-y-[-150%]');
            setTimeout(() => toast.classList.add('translate-y-[-150%]'), 3000);
        }
        
        function fillChat(text) {
            document.getElementById('chatInput').value = text;
        }

        function handleChatKey(e) {
            if (e.key === 'Enter') sendChat();
        }

        function sendChat() {
            const input = document.getElementById('chatInput');
            const container = document.getElementById('chatContainer');
            const text = input.value.trim();
            if(!text) return;

            container.innerHTML += `<div class="flex justify-end animate-fade-in"><div class="bg-brand-600 p-3 rounded-2xl rounded-tr-none shadow-md text-sm text-white max-w-[80%]">${text}</div></div>`;
            input.value = '';
            container.scrollTop = container.scrollHeight;

            setTimeout(() => {
                const reply = getBotReply(text);
                
                container.innerHTML += `<div class="flex items-start gap-3 animate-fade-in"><div class="w-8 h-8 rounded-full bg-brand-100 flex items-center justify-center text-brand-600"><i class="fa-solid fa-robot text-sm"></i></div><div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm border border-slate-100 text-sm text-slate-700 max-w-[80%]">${reply}</div></div>`;
                container.scrollTop = container.scrollHeight;
            }, 800);
        }

        // --- Charts (static data) ---
        let studyChartInstance = null;
        let trafficChartInstance = null;
        function renderStudyChart() {
            if(studyChartInstance) studyChartInstance.destroy();
            const ctx = document.getElementById('studyChart').getContext('2d');
            if (!ctx) return;
            studyChartInstance = new Chart(ctx, {
                type: 'line', data: { labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'], datasets: [{ label: 'CGPA', data: [7.8, 8.2, 8.0, 8.5], borderColor: '#4f46e5', tension: 0.4 }] },
                options: { scales: { y: { min: 6, max: 10 } } }
            });
        }
        function renderTrafficChart() {
            if(trafficChartInstance) trafficChartInstance.destroy();
            const ctx = document.getElementById('trafficChart').getContext('2d');
            if (!ctx) return;
            trafficChartInstance = new Chart(ctx, {
                type: 'bar', data: { labels: ['12:30', '1:00', '1:30', '2:00', '4:30'], datasets: [{ label: 'Crowd %', data: [40, 95, 90, 60, 75], backgroundColor: (ctx) => ctx.raw > 80 ? '#ef4444' : ctx.raw > 50 ? '#eab308' : '#22c55e' }] },
                options: { scales: { y: { max: 100 } } }
            });
        }
        
        // --- Tab switching for login/reg modal ---
        function showLoginTab(show) {
            document.getElementById('loginTab').style.display = show ? 'block' : 'none';
            document.getElementById('regTab').style.display = show ? 'none' : 'block';
            document.getElementById('loginTabBtn').classList.toggle('border-brand-600', show);
            document.getElementById('loginTabBtn').classList.toggle('text-brand-600', show);
            document.getElementById('regTabBtn').classList.toggle('border-brand-600', !show);
            document.getElementById('regTabBtn').classList.toggle('text-brand-600', !show);
        }

        // --- ADD ALL EVENT LISTENERS ONCE DOM IS LOADED ---
        document.addEventListener('DOMContentLoaded', () => {
            // Login/Register
            document.getElementById('loginTabBtn').addEventListener('click', () => showLoginTab(true));
            document.getElementById('regTabBtn').addEventListener('click', () => showLoginTab(false));
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('registerBtn').addEventListener('click', handleRegister);

            // Main Nav
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => showSection(btn.dataset.section));
            });

            // Mobile Nav
            document.getElementById('mobileMenuBtn').addEventListener('click', toggleMobileMenu);
            document.getElementById('mobileMenuClose').addEventListener('click', toggleMobileMenu);
            document.getElementById('mobileLogoutBtn').addEventListener('click', handleLogout);
            document.querySelectorAll('.mobile-nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    showSection(btn.dataset.section);
                    toggleMobileMenu();
                });
            });

            // Planner
            document.getElementById('generatePlanBtn').addEventListener('click', generatePlan);

            // Chatbot
            document.getElementById('sendChatBtn').addEventListener('click', sendChat);
            document.getElementById('chatInput').addEventListener('keypress', handleChatKey);
            document.querySelectorAll('.fill-chat-btn').forEach(btn => {
                btn.addEventListener('click', () => fillChat(btn.dataset.text));
            });

            // Admin
            document.getElementById('loadAllUsersBtn').addEventListener('click', loadAllUsers);
            document.getElementById('saveUserBtn').addEventListener('click', handleAdminUserSave);
            document.getElementById('cancelSaveUserBtn').addEventListener('click', cancelAdminUserSave);
            
            // Delete Modal
            document.getElementById('cancelDeleteBtn').addEventListener('click', hideDeleteModal);
            document.getElementById('confirmDeleteBtn').addEventListener('click', handleAdminDeleteUser);

        });

    </script>
</body>
</html>